<!doctype html>
<html lang="pt-br">

<head>
  <title>taxi...</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS v5.2.1 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
  <style>
    strong{
      color: darkred;
      font-size: smaller;
    }
  </style>
</head>

<body>
  <header>
    <!-- place navbar here -->
  </header>
  <main>
    <div id="tela"></div>
    <br/>
    <form class="d-flex">
        <div class="col">
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">R$</span>
                </div>
                <input type="number" class="form-control" aria-label="Quantia" id="valor">
                <div class="input-group-append">
                  <span class="input-group-text">.00</span>
                </div>
            </div>              
              
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="avista" value="avista" checked>
                <label class="form-check-label" for="inlineRadio1">Ávista</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="pix" value="pix">
                <label class="form-check-label" for="inlineRadio2">Pix</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="cartao" value="cartao">
                <label class="form-check-label" for="inlineRadio2">Cart</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="dev" value="dev" >
                <label class="form-check-label" for="inlineRadio3">dev</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="pg" value="pago" >
                <label class="form-check-label" for="inlineRadio3">Pg</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="gas" value="gas" >
                <label class="form-check-label" for="inlineRadio3">Gás</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="inlineRadioOptions" id="extra" value="extra" >
                <label class="form-check-label" for="inlineRadio3">Extra</label>
            </div>

            <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text">Obs:</span>
                </div>
                <textarea class="form-control" aria-label="Com textarea" id="obs"></textarea>
              </div>
            
              

              <br/>
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">inicial</span>
                </div>
                <input type="number" class="form-control" aria-label="Quantia" id="kmini">
                <div class="input-group-append">
                  <span class="input-group-text">Km</span>
                </div>

                <div class="input-group-prepend">
                    <span class="input-group-text">final</span>
                  </div>
                  <input type="number" class="form-control" aria-label="Quantia" id="kmfim">
                  <div class="input-group-append">
                    <span class="input-group-text">Km</span>
                  </div>
            </div>              
            <small>troco</small>
            <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">ini R$</span>
                </div>
                <input type="number" class="form-control" aria-label="Quantia" id="trocor">
                <div class="input-group-append">
                  <span class="input-group-text">.00</span>
                </div>

                <div class="input-group-prepend">
                  <span class="input-group-text">fim R$</span>
                </div>
                <input type="number" class="form-control" aria-label="Quantia" id="trocod">
                <div class="input-group-append">
                  <span class="input-group-text">.00</span>
                </div>
            </div>
        </div>

        

    </form><br/>
    <div class="d-flex">
        <div class="col">
          
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                    <button class="btn btn-primary" id="exe">registrar...</button>
                </div>
                  <div class="input-group-prepend">                    
                    <span class="input-group-text">motora</span>
                  </div>
                  <input type="number" class="form-control" aria-label="Quantia" id="percentual">
                    <div class="input-group-append">
                      <span class="input-group-text">%</span>                      
                    </div>
                    <div class="input-group-prepend">
                      <button class="btn btn-primary" id="limpar">limpar...</button>
                    </div>
                  </div>

                
              </div>
      </div>
            
  </main>
  <footer>
    <!-- place footer here -->
  </footer>
  <!-- Bootstrap JavaScript Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous">
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
    integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous">
  </script>
</body>
    <script>
        var obj = {
            valor: 0,
            tipo: '',
            km: 0,
            obs: ''
        }
        var reg = new Array();

        window.onload = function(){
          console.log('window onload');

          carregarRegistros();
          
        }
        document.getElementById('exe').addEventListener('click', ()=>{
          if (document.getElementById('kmini').value) {
            setCookie('kmini', parseInt(document.getElementById('kmini').value));
          }
          if (document.getElementById('kmfim').value) {
            setCookie('kmfim', parseInt(document.getElementById('kmfim').value));
          }
          if (document.getElementById('trocor').value) {
            setCookie('trocor', parseInt(document.getElementById('trocor').value));
          }
          if (document.getElementById('trocod').value) {
            setCookie('trocod', parseInt(document.getElementById('trocod').value));
          }
            obj = {
                valor: 0,
                tipo: '',
                km: 0,
                obs: ''
            }
            let valor = document.getElementById('valor').value;
            if(valor > 0){
                //console.log('maior que zero');
                obj.valor = valor;
                //avista, pix ou dev
                //console.log('a vista: '+ document.getElementById('avista').checked);
                if (document.getElementById('avista').checked) {
                    obj.tipo = 'avista';
                }
                if (document.getElementById('pix').checked) {
                    obj.tipo = 'pix';
                }
                if (document.getElementById('dev').checked) {
                    obj.tipo = 'dev';
                }
                if (document.getElementById('cartao').checked) {
                    obj.tipo = 'cartao';
                }
                if (document.getElementById('pg').checked) {
                    obj.tipo = 'pg';
                }
                if (document.getElementById('gas').checked) {
                    obj.tipo = 'gas';
                }
                if (document.getElementById('extra').checked) {
                    obj.tipo = 'extra';
                }
                //
                obj.obs = document.getElementById('obs').value;
                if (document.getElementById('obs').value == '' && obj.tipo == 'dev' || document.getElementById('obs').value == '' && obj.tipo == 'pg' || document.getElementById('obs').value == '' && obj.tipo == 'extra') {
                  alert('obs ñ pode ser nullo ...');
                }else{
                  if(document.getElementById('kmfim').value){
                    obj.km = parseInt(document.getElementById('kmfim').value);
                  }
                  reg.push(obj);
                }
                console.log('R$: '+ obj.valor);
                console.log('tipo: '+ obj.tipo);
                console.log('obs: '+ obj.obs);
                console.log('Km: '+ obj.km);
            }else{
                console.log('zero ñ registrado');
            }
            
            //parseInt(document.getElementById('kmfim').value)
            reset();
            imprimir();
        })
        document.getElementById('limpar').addEventListener('click', ()=>{
          console.log('limpar clicado');
          deletCookie();          
          imprimir();
        })
        function reset(){
            document.getElementById('valor').value = null;
            document.getElementById('avista').checked = true;
            document.getElementById('obs').value = '';
        }
        function imprimir(){//aqui é feito as somas do array de registros
          let totalBruto = 0;
          let totalDia = 0;
          let liquido = 0;
          let gas = 0;
          let extra = 0;
          let extraTxt = '';
          let km = 0;
            limparTela();
            let cont = 0;//contador de corridas...
            for (let i = 0; i < reg.length; i++) {
                const registro = reg[i];
                /*adiciona icone
                n) corrida
                ;) pagamento de divida
                x) gasto
                */
                  if(registro.tipo != 'gas' && registro.tipo != 'extra' && registro.tipo != 'pg'){
                    cont++;
                    addTela('<br/>'+cont+' ) ');
                  }else{
                    if(registro.tipo == 'pg'){
                      addTela('<br/> ; )');
                    }else{
                      addTela('<br/> x )');
                    }                    
                  }
                addTela('R$: '+ registro.valor +' '+registro.tipo +' <small>Obs: '+ registro.obs);
                //calculos...
                if (registro.tipo == 'avista' || registro.tipo == 'pix' || registro.tipo == 'cartao' || registro.tipo == 'dev') {
                  totalDia += parseInt(registro.valor);
                  if (km < registro.km) {
                    km = registro.km;
                    //kilometragem mais alta no momento
                    //calcular R$/km do momento atual
                    let mediakm = totalDia / (km - parseInt(document.getElementById('kmini').value));
                    addTela(' R$/Km: '+ mediakm.toFixed(2) +' ');
                  }                  
                }
                //adiciona link excluir
                addTela('</small> &nbsp;&nbsp;&nbsp;<strong onclick="delReg('+i+')" class="red"> excluir </strong>')
                if (registro.tipo == 'pg'){
                  totalBruto += parseInt(registro.valor);
                }
                //liquido dinheiro em mãos
                if(registro.tipo == 'pix' || registro.tipo == 'cartao' || registro.tipo == 'dev' || registro.tipo == 'gas' || registro.tipo == 'extra'){
                  liquido += parseInt(registro.valor);
                }
                if (registro.tipo == 'gas') {
                  gas += parseInt(registro.valor);
                }
                if (registro.tipo == 'extra') {
                  extra += parseInt(registro.valor);
                  extraTxt += ' *'+registro.obs;
                }
            }

            //
            addTela('<hr>total Dia: '+ totalDia);
            //calcular comissão motorista...
            if (document.getElementById('percentual').value) {
              let percent = parseInt(document.getElementById('percentual').value);
              percent /= 100;
              let temp = totalDia * percent;
              addTela('<hr>comissão motorista: R$ '+ temp);
            }
            totalBruto += totalDia;
            addTela('<br/>total Bruto: '+ totalBruto);
            let totalliquido = totalBruto - liquido;
            if(parseInt(document.getElementById('trocor').value)){
              totalliquido +=  parseInt(document.getElementById('trocor').value);
            }
            if (parseInt(document.getElementById('trocod').value)) {
              totalliquido -= parseInt(document.getElementById('trocod').value);
            }
            
            
            addTela('<br/>total liquido: '+ totalliquido);
            addTela('<br/>Gás: '+ gas);
            addTela('<br/>Gastos extra: '+ extra +extraTxt);
            //converter obj em string****************************************************************
            //let cookieValor = JSON.stringify(reg);            
            setCookie('registro', JSON.stringify(reg));
          //km rodado
            let kmRodado = parseInt(document.getElementById('kmfim').value) - parseInt(document.getElementById('kmini').value);
            
            addTela('<br/>km rodado: '+ kmRodado);
        }
        
        //
        function setCookie(nameCookie, cookieConteudo) {
            const d = new Date();
            d.setTime(d.getTime() + (365*24*60*60*1000));
            let expires = "expires="+ d.toUTCString();
            document.cookie = nameCookie +"="+ cookieConteudo +";"+ expires;
            console.log('cookie setado => '+document.cookie);
          
        }
        
        function deletCookie(){
          document.cookie = "registro=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          reg = new Array();
          document.cookie = "kmini=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "kmfim=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "trocor=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
          document.cookie = "trocod=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        }
        
        function delReg(n){
          if (confirm('tem certeza que deseja excluir o registro '+ reg[n].valor +' : '+ reg[n].tipo)) {
            reg.splice(n, 1);
            setCookie('registro', JSON.stringify(reg));
            //let cookieValor = JSON.stringify(reg);
            //document.cookie = "registro="+ cookieValor;
            console.log('cookie setado => '+document.cookie);
            imprimir();
          }          
        }
              
        function carregarRegistros(){
          
          let strCookie = document.cookie;          
          if (strCookie != "") {
            let bis = strCookie.split('; ');
            bis.forEach(biscoito => {
              let str = biscoito.split('=');
              console.log('cookie:'+ str[0] +' => '+ str[1]);//
              //carregar registro...
              if (str[0] == "registro") {//carrega registro do cookie para o array reg... ATENÇÃO ao espaço no inicio da string...
                reg = JSON.parse(str[1]);
                console.log('=====>>>>> carregou reg...');
              }
              //carregar cookie kmini...
              if (str[0] == 'kmini') {
                if (!document.getElementById('kmini').value) {
                  document.getElementById('kmini').value = parseInt(str[1]);
                }
              }
              if (str[0] == 'kmfim') {
                if (!document.getElementById('kmfim').value) {
                  document.getElementById('kmfim').value = parseInt(str[1]);
                }
              }
              if (str[0] == 'trocor') {
                if (!document.getElementById('trocor').value) {
                  document.getElementById('trocor').value = parseInt(str[1]);
                }
              }


              if (str[0] == 'trocod') {
                if (!document.getElementById('trocod').value) {
                  document.getElementById('trocod').value = parseInt(str[1]);
                }
              }


            });
            console.log('registros carregados a partir dos cookies...');
                        
            console.log('imprimir...');
            imprimir();
          }else{
            console.log('sem registros em cookie...');
          }
        }
        function addTela(conteudo){
          document.getElementById('tela').innerHTML += conteudo;
        }
        function limparTela(){
          document.getElementById('tela').innerHTML = '';
        }
    </script>
</html>